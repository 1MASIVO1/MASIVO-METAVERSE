<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>MASIVO METAVERSE</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<header style="display:flex;justify-content:space-between;align-items:center;padding:15px;background:#111;color:white;">
  <h2>MASIVO METAVERSE</h2>
  <div id="authSection">
    <button onclick="showAuth()">Login / Register</button>
  </div>
</header>

<!-- AUTH MODAL -->
<div id="authModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);justify-content:center;align-items:center;">
  <div style="background:#222;padding:20px;border-radius:10px;width:300px;color:white;">
    <h3>Login / Register</h3>
    <input id="email" type="email" placeholder="Email" style="width:100%;margin-bottom:10px;">
    <input id="password" type="password" placeholder="Password" style="width:100%;margin-bottom:10px;">
    <button onclick="login()">Login</button>
    <button onclick="register()">Register</button>
    <button onclick="closeAuth()">Cerrar</button>
  </div>
</div>

<main style="padding:20px;">
  <div class="nft-card">
    <img src="images/masivo1.png" width="300">
    <div>
      <button onclick="likeNFT(1)">üëç Like</button>
      <span id="likes-1">0</span>
    </div>
    <div>
      üëÅÔ∏è <span id="views-1">0</span>
    </div>

    <div>
      <input id="comment-input-1" placeholder="Escribe comentario">
      <button onclick="addComment(1)">Comentar</button>
    </div>

    <div id="comments-1"></div>
  </div>
</main>

<script>

const supabase = window.supabase.createClient(
  "https://rnkuxwsuztewgbdmjyxt.supabase.co",
  "sb_publishable_TU_KEY_AQUI"
);

let currentUser = null;

// AUTH UI
function showAuth(){
  document.getElementById("authModal").style.display="flex";
}
function closeAuth(){
  document.getElementById("authModal").style.display="none";
}

async function register(){
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  const { error } = await supabase.auth.signUp({ email, password });
  if(error) alert(error.message);
  else alert("Revisa tu email para confirmar");
}

async function login(){
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  const { error } = await supabase.auth.signInWithPassword({ email, password });
  if(error) alert(error.message);
  else {
    closeAuth();
    loadUser();
  }
}

async function logout(){
  await supabase.auth.signOut();
  location.reload();
}

async function loadUser(){
  const { data } = await supabase.auth.getUser();
  currentUser = data.user;
  if(currentUser){
    document.getElementById("authSection").innerHTML = `
      ${currentUser.email}
      <button onclick="logout()">Logout</button>
    `;
  }
}

// LIKE
async function likeNFT(id){
  if(!currentUser){
    alert("Debes iniciar sesi√≥n");
    return;
  }
  let likes = document.getElementById("likes-"+id);
  likes.textContent = parseInt(likes.textContent)+1;
}

// COMMENTS
async function addComment(id){
  if(!currentUser){
    alert("Debes iniciar sesi√≥n");
    return;
  }
  const input = document.getElementById("comment-input-"+id);
  const text = input.value;
  if(!text) return;

  const container = document.getElementById("comments-"+id);
  const div = document.createElement("div");
  div.textContent = currentUser.email + ": " + text;
  container.appendChild(div);
  input.value="";
}

// VIEWS
window.onload = async () => {
  loadUser();
  let views = document.getElementById("views-1");
  views.textContent = parseInt(views.textContent)+1;
};

</script>

</body>
</html>
